<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Team 8 — Energy Sector — Offensive Posture (Week 5 Demo Skeleton)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f1115; --panel:#151821; --muted:#1c2030; --text:#e9ecf1; --sub:#aab1c2; --accent:#67b0ff; --green:#44d28b; --red:#ff6b6b; --yellow:#ffd166;
      --border:#2a3042; --chip:#22283a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0d13,#0f1115);color:var(--text);font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial;}
    a{color:var(--accent);text-decoration:none}
    header{position:sticky;top:0;z-index:10;background:rgba(10,12,17,.7);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .wrap{max-width:1200px;margin:0 auto;padding:0 16px}
    .nav{display:flex;gap:16px;align-items:center;min-height:60px}
    .brand{font-weight:800;letter-spacing:.4px}
    .nav a.btn{padding:8px 12px;border-radius:10px;background:var(--muted);border:1px solid var(--border)}
    .nav a.btn.active{background:var(--chip);border-color:#3a425d}
    main{max-width:1200px;margin:24px auto;padding:0 16px;display:grid;grid-template-columns:1fr;gap:16px}
    .grid{display:grid;gap:16px}
    .cols-2{grid-template-columns:1.2fr .8fr}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:hidden}
    .panel h2,.panel h3{margin:0;padding:14px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#161a25,#131722)}
    .panel .body{padding:16px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:var(--chip);border:1px solid var(--border);color:var(--sub);font-size:12px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .input, select{background:#0f1320;border:1px solid var(--border);color:var(--text);border-radius:12px;padding:10px 12px;width:100%}
    .btn{cursor:pointer;background:#192033;border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px}
    .btn.primary{background:linear-gradient(180deg,#1b2a45,#1a2b4f);border-color:#2f3e60}
    .btn.success{background:#163226;border-color:#265f45}
    .btn.danger{background:#3a1c22;border-color:#5d2b33}
    .tag{font-size:12px;color:var(--sub)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
    tbody tr:hover{background:#141a26}
    iframe{width:100%;height:380px;border:0;border-top:1px solid var(--border)}
    footer{margin:24px 0 60px;color:var(--sub);text-align:center}
    .hidden{display:none}
    .ok{color:var(--green)} .warn{color:var(--yellow)} .bad{color:var(--red)}
    /* tiny status lights */
    .dot{display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--yellow)}
    .dot.ok{background:var(--green)} .dot.bad{background:var(--red)}
    .callout{padding:12px;border:1px dashed #39415a;border-radius:12px;background:#121725;color:var(--sub)}
    .kbd{padding:2px 6px;border:1px solid var(--border);border-radius:6px;background:#0d111b;color:#c9d3ea;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .small{font-size:12px;color:var(--sub)}
    .section{scroll-margin-top:80px}
  </style>
</head>
<body>
  <!-- HEADER / NAV -->
  <header>
    <div class="wrap nav">
      <div class="brand">Team 8 — Energy Offense</div>
      <nav class="row" id="nav">
        <a class="btn active" href="#home">Home</a>
        <a class="btn" href="#auth">Login & Roles</a>
        <a class="btn" href="#recon">Recon</a>
        <a class="btn" href="#phishing">Phishing</a>
        <a class="btn" href="#scoring">Scoring</a>
        <a class="btn" href="#hil">HIL Control</a>
        <a class="btn" href="#about">About</a>
      </nav>
      <div class="chip"><span class="dot" id="status-dot"></span> demo status</div>
    </div>
  </header>

  <main>
    <!-- HOME / OVERVIEW (integrates index.html narrative) -->
    <section id="home" class="section grid cols-2">
      <div class="panel">
        <h2>Overview & Hypothesis</h2>
        <div class="body">
          <p class="tag">Context</p>
          <p><strong>Hypothesis:</strong> AI recon agents can analyze energy systems significantly faster (parallel, low cost) while remaining under <em>human approval</em> for risky actions.</p>
          <div class="row">
            <span class="chip">Industry realism</span>
            <span class="chip">RBAC</span>
            <span class="chip">Evaluation</span>
            <span class="chip">HIL</span>
          </div>
          <div class="callout" style="margin-top:12px">
            This page unifies our earlier prototypes into a single realistic workflow: <strong>Login → Recon → Phishing → Scoring → HIL</strong>.
          </div>
          <p class="small">Source: integrated from our Week 1 narrative page.</p>
        </div>
        <!-- Embed your existing index.html to show original background & flow -->
        <iframe src="index.html" title="Week1 Narrative (index.html)"></iframe>
      </div>

      <div class="panel">
        <h2>Demo Quick Controls</h2>
        <div class="body">
          <div class="row">
            <button class="btn" onclick="setStatus('ok')">Mark Status: <span class="ok">OK</span></button>
            <button class="btn" onclick="setStatus('warn')">Mark Status: <span class="warn">Needs Work</span></button>
            <button class="btn" onclick="setStatus('bad')">Mark Status: <span class="bad">Blocked</span></button>
          </div>
          <p class="small" style="margin-top:10px">Use this to communicate demo readiness during the feedback lab.</p>
          <hr style="border-color:var(--border)">
          <p class="tag">This Week</p>
          <ul>
            <li>Publish cloud URL for this demo (non-localhost)</li>
            <li>Provide test creds in #announcements</li>
            <li>Test at least 2 other teams (1 offense + 1 defense)</li>
          </ul>
          <p class="small">Lab rules: synthetic data only, keep HIL for risky actions, log agent actions.</p>
        </div>
      </div>
    </section>

    <!-- AUTHENTICATION & ROLES -->
    <section id="auth" class="section panel">
      <h2>Login & Role Authentication (Token + Lead Hacker Approval)</h2>
      <div class="body grid cols-2">
        <div>
          <label class="tag">Access Token (not email/password)</label>
          <input class="input" id="token" placeholder="paste token here e.g. T8-PSE-OPS-2025" />
          <div class="row" style="margin-top:10px">
            <select id="role" class="input">
              <option value="recon">Recon Operator</option>
              <option value="supervisor">Supervisor</option>
              <option value="lead">Lead Hacker</option>
            </select>
            <button class="btn primary" onclick="requestAccess()">Request Access</button>
          </div>
          <p id="auth-msg" class="small"></p>
          <div id="lead-approve" class="hidden" style="margin-top:10px">
            <div class="callout">
              <strong>Lead Hacker Call</strong>: “Approve access for token <span id="tok"></span> as <span id="rl"></span>?”
              <div class="row" style="margin-top:8px">
                <button class="btn success" onclick="approveAccess(true)">Approve</button>
                <button class="btn danger" onclick="approveAccess(false)">Reject</button>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="callout">
            <p><strong>Realism:</strong> Energy operations rarely rely on simple email/password. We simulate a gate requiring a token + a manual approval by a <em>Lead Hacker</em> (2FA-like human step).</p>
            <ul class="small">
              <li>// TODO [Vidhya]: Replace with a nicer modal & visual call flow.</li>
              <li>// TODO [Frecesca]: Plug this decision into HIL log below.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- RECON (integrates week2.html) -->
    <section id="recon" class="section panel">
      <h2>Recon Module (LinkedIn / Perplexity Targets + Speed PoC)</h2>
      <div class="body">
        <p class="tag">Proof-of-Concept Speed (Week 2)</p>
        <p>Below embeds our Week 2 “AI vs Human Recon Race” demo to demonstrate speed & parallelism.</p>
        <iframe src="week2.html" title="Week2 Recon Race (week2.html)"></iframe>

        <div class="grid cols-2" style="margin-top:16px">
          <div>
            <h3>Target Discovery (Synthetic)</h3>
            <table>
              <thead><tr><th>Name</th><th>Role</th><th>Email</th><th>Bounce</th><th>Seed Score</th></tr></thead>
              <tbody id="targets">
                <!-- Seeded examples; in Week 6 we’ll iterate these with model outputs -->
              </tbody>
            </table>
            <p class="small">
              // TODO [Frecesca]: connect discovery → phishing selection flow. <br>
              // TODO [Kibret]: populate with LinkedIn/Perplexity-derived synthetic list + bounce check (0/1).
            </p>
          </div>
          <div>
            <h3>Notes</h3>
            <div class="callout">
              <ul class="small">
                <li>Discovery sources: LinkedIn title patterns, company domain guessing, SMTP ping.</li>
                <li>// TODO [Kibret]: add columns for <em>it/ot access</em>, <em>mfa</em>, <em>shift</em>, etc.</li>
                <li>// TODO [Vidhya]: add quick filters (role, region, access level).</li>
              </ul>
            </div>
            <div class="row">
              <button class="btn" onclick="mockDiscover()">Mock Discover Targets</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PHISHING (uses email_agent outputs as examples) -->
    <section id="phishing" class="section panel">
      <h2>Phishing Engine (Personalized Drafts + HIL Review)</h2>
      <div class="body grid cols-2">
        <div>
          <label class="tag">Selected Target</label>
          <select id="pickTarget" class="input"></select>

          <label class="tag" style="margin-top:10px">Draft Email (generated offline by agent)</label>
          <textarea class="input" id="emailDraft" rows="9" placeholder="AI-generated email will appear here…"></textarea>

          <div class="row" style="margin-top:10px">
            <button class="btn" onclick="generateDraft()">Generate Draft</button>
            <button class="btn" onclick="tweakTone()">Tone: balanced</button>
            <button class="btn" onclick="hilQueue()">Send to HIL Queue</button>
          </div>
          <p class="small">
            // TODO [Frecesca]: wire this to HIL queue table below. <br>
            // TODO [Vidhya]: add tone switch UI (formal / balanced / casual). <br>
            // TODO [Kibret]: optional model prompt log reference (explainability).
          </p>
        </div>
        <div>
          <div class="callout">
            <p><strong>Realism:</strong> Before any outbound action, content is queued for human review. We keep a “no-autosend” policy for risky actions.</p>
            <p class="small">Emails are <em>examples</em> produced by our offline <code>email_agent.py</code>; no real systems are touched.</p>
          </div>
          <div class="panel" style="margin-top:10px">
            <h3 style="border:0">HIL Review Queue (pending)</h3>
            <div class="body">
              <table>
                <thead><tr><th>Target</th><th>Subject</th><th>Status</th></tr></thead>
                <tbody id="hilQueueTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SCORING & EVALUATION (logistic regression placeholder) -->
    <section id="scoring" class="section panel">
      <h2>Scoring & Evaluation (Logistic Regression + Iterations)</h2>
      <div class="body grid cols-2">
        <div>
          <table>
            <thead><tr><th>Target</th><th>Features</th><th>RiskScore</th><th>Prob.</th><th>Label</th></tr></thead>
            <tbody id="scoreTable"></tbody>
          </table>
          <p class="small">
            // TODO [Kibret]: Replace mock scores with logistic regression outputs (JSON endpoint or inline data). <br>
            // TODO [Vidhya]: add sparkline or nicer chart.
          </p>
          <div class="row">
            <button class="btn" onclick="runIteration()">Run Iteration</button>
            <span class="tag">Iteration: <span id="iter">0</span></span>
          </div>
        </div>
        <div>
          <canvas id="chart" width="520" height="260" style="background:#0f1320;border:1px solid var(--border);border-radius:12px"></canvas>
          <p class="small">
            Mock learning curve (accuracy ↑ with iterations). <br>
            // TODO [Kibret]: bind to real metrics: accuracy / FPR / runtime. <br>
            // TODO [Frecesca]: narrate eval criteria (speed, precision vs false-positives, operational risk).
          </p>
        </div>
      </div>
    </section>

    <!-- HIL CONTROL (approval + logs) -->
    <section id="hil" class="section panel">
      <h2>Human-in-the-Loop Control Center</h2>
      <div class="body grid cols-2">
        <div>
          <label class="tag">Approval Actions</label>
          <div class="row">
            <button class="btn success" onclick="approveSelected()">Approve Selected</button>
            <button class="btn danger" onclick="rejectSelected()">Reject Selected</button>
            <button class="btn" onclick="killSwitch()">Emergency Kill-Switch</button>
          </div>
          <p class="small">
            // TODO [Frecesca]: ensure approvals update phishing send-state + scoring feedback. <br>
            // TODO [Vidhya]: confirmation modals; disabled-state if not Supervisor/Lead.
          </p>
        </div>
        <div>
          <h3 style="margin:0 0 10px 0">Approval Log</h3>
          <table>
            <thead><tr><th>Time</th><th>Actor</th><th>Action</th><th>Object</th></tr></thead>
            <tbody id="hilLog"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ABOUT / RESEARCH SUMMARY -->
    <section id="about" class="section panel">
      <h2>About & Research Summary</h2>
      <div class="body grid cols-2">
        <div>
          <p><strong>Team:</strong> Vidhya Narayanan · Kibret Ogale · Frecesca (Meixuan) Wang</p>
          <ul>
            <li><strong>Stakeholder insights:</strong> detection speed, precision vs. false positives, operational risk.</li>
            <li><strong>Policy:</strong> Synthetic data only. No interaction with real infrastructure.</li>
            <li><strong>HIL:</strong> All risky actions require explicit human approval.</li>
          </ul>
          <p class="small">// TODO [Frecesca]: paste 2–3 bullet quotes from stakeholders & class feedback.</p>
        </div>
        <div class="callout">
          <p><strong>Demo 3 target:</strong> Show end-to-end workflow with realistic roles & evaluation. Even partial automation is OK if logic & controls are explicit.</p>
          <p class="small">Next: connect model outputs, finalize role-based UI, tighten approval audit trail.</p>
        </div>
      </div>
    </section>

    <footer>
      <p>Ethics & Safety: This is a simulated environment with synthetic data. No real systems/accounts are accessed. Human-in-the-loop approval is mandatory for risky actions.</p>
      <p class="small">© Team 8 — Energy Offense · INFO 492</p>
    </footer>
  </main>

  <script>
    // -------------------------
    // GLOBAL DEMO STATE
    // -------------------------
    const state = {
      auth:{role:null, token:null, approved:false},
      targets:[],
      hilQueue:[],
      scores:[],
      iteration:0,
      tone:'balanced'
    };

    // Status light
    function setStatus(level){
      const dot=document.getElementById('status-dot');
      dot.classList.remove('ok','bad');
      if(level==='ok') dot.classList.add('ok');
      if(level==='bad') dot.classList.add('bad');
    }

    // -------------------------
    // AUTH FLOW (token + lead approval)
    // -------------------------
    function requestAccess(){
      const tokenEl=document.getElementById('token');
      const roleEl=document.getElementById('role');
      const msg=document.getElementById('auth-msg');
      const token=tokenEl.value.trim();
      const role=roleEl.value;
      if(!token){ msg.textContent='Provide access token.'; return; }
      state.auth.token=token; state.auth.role=role; state.auth.approved=false;
      document.getElementById('tok').textContent=token;
      document.getElementById('rl').textContent=role;
      document.getElementById('lead-approve').classList.remove('hidden');
      msg.textContent='Request sent to Lead Hacker for manual approval…';
    }
    function approveAccess(ok){
      const msg=document.getElementById('auth-msg');
      document.getElementById('lead-approve').classList.add('hidden');
      state.auth.approved=!!ok;
      if(ok){
        msg.innerHTML = 'Access <span class="ok">approved</span>. Role: <b>'+state.auth.role+'</b>';
        hilLog('LeadHacker','approve-access',state.auth.token);
      }else{
        msg.innerHTML = 'Access <span class="bad">rejected</span>.';
        hilLog('LeadHacker','reject-access',state.auth.token);
      }
      // TODO [Vidhya]: gate UI sections by role/approval if desired.
    }

    // -------------------------
    // RECON MOCK DISCOVERY
    // -------------------------
    function mockDiscover(){
      // Seed a few synthetic PSE operational roles
      const seed=[
        {name:'Alex R.', role:'Hydroelectric Operator', email:'alex.r@pse-demo.com', bounce:0, score:0.62},
        {name:'Jamie T.', role:'Energy Mgmt Engineer', email:'jamie.t@pse-demo.com', bounce:0, score:0.71},
        {name:'Priya S.', role:'Vendor Technician', email:'priya.s@pse-vendor.com', bounce:1, score:0.38},
        {name:'Noah M.', role:'Substation Analyst', email:'noah.m@pse-demo.com', bounce:0, score:0.55}
      ];
      state.targets=seed;
      renderTargets();
      fillTargetPicker();
    }
    function renderTargets(){
      const tbody=document.getElementById('targets');
      tbody.innerHTML='';
      state.targets.forEach(t=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${t.name}</td><td>${t.role}</td><td>${t.email}</td>
                      <td>${t.bounce?'<span class="bad">✖</span>':'<span class="ok">✔</span>'}</td>
                      <td>${(t.score*100|0)/100}</td>`;
        tbody.appendChild(tr);
      });
    }
    function fillTargetPicker(){
      const sel=document.getElementById('pickTarget');
      sel.innerHTML='';
      state.targets.forEach((t,i)=>{
        const o=document.createElement('option');
        o.value=i; o.textContent=`${t.name} — ${t.role}`;
        sel.appendChild(o);
      });
    }

    // -------------------------
    // PHISHING DRAFTS (mock, inspired by email_agent.py)
    // -------------------------
    function generateDraft(){
      const i=parseInt(document.getElementById('pickTarget').value||0,10);
      const t=state.targets[i]||{name:'Operator',role:'Ops',email:'ops@pse-demo.com'};
      const subj = `[Action Required] SCADA maintenance window for ${t.role}`;
      const body = 
`Hi ${t.name.split(' ')[0]},

We’re scheduling a brief maintenance window for your ${t.role}.
Please review the attached checklist and confirm your shift availability.
If you cannot access the portal, use the temporary link below (expires in 15 minutes).

Best,
Grid Ops Support
`;
      document.getElementById('emailDraft').value = `Subject: ${subj}\n\n${body}`;
    }
    function tweakTone(){
      const btns = ['formal','balanced','casual'];
      const idx = btns.indexOf(state.tone);
      state.tone = btns[(idx+1)%btns.length];
      alert('Tone set to: '+state.tone+' (placeholder)');
    }
    function hilQueue(){
      const i=parseInt(document.getElementById('pickTarget').value||0,10);
      const t=state.targets[i];
      if(!t){ alert('Pick a target first'); return; }
      const draft=document.getElementById('emailDraft').value.trim();
      if(!draft){ alert('Generate a draft first'); return; }
      state.hilQueue.push({target:t.name, subject:draft.split('\n')[0].replace('Subject: ','') , status:'pending'});
      renderHilQueue();
      hilLog('ReconOperator','queue-email',t.name);
    }
    function renderHilQueue(){
      const tb=document.getElementById('hilQueueTable');
      tb.innerHTML='';
      state.hilQueue.forEach((q,idx)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${q.target}</td><td>${q.subject}</td><td>${q.status}</td>`;
        tr.onclick=()=>{ tr.classList.toggle('selected'); tr.dataset.idx=idx; };
        tb.appendChild(tr);
      });
    }

    // -------------------------
    // SCORING (mock logistic regression + iterations)
    // -------------------------
    function seedScores(){
      state.scores = state.targets.map(t=>{
        const p = Math.max(0.05, Math.min(0.95, t.score + (Math.random()*0.2-0.1)));
        return {target:t.name, features:'role, mfa, vendor, shift', risk: +(p.toFixed(2)), prob:+(p.toFixed(2)), label: p>0.6?1:0};
      });
      renderScores();
      drawChart();
    }
    function renderScores(){
      const tb=document.getElementById('scoreTable');
      tb.innerHTML='';
      state.scores.forEach(s=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${s.target}</td><td>${s.features}</td><td>${s.risk}</td><td>${s.prob}</td><td>${s.label}</td>`;
        tb.appendChild(tr);
      });
    }
    function runIteration(){
      state.iteration++;
      document.getElementById('iter').textContent=state.iteration;
      // mock: tighten probabilities slightly toward clearer separation
      state.scores = state.scores.map(s=>{
        const shift = s.label? 0.03 : -0.03;
        const p = Math.max(0.03, Math.min(0.97, s.prob + shift + (Math.random()*0.02-0.01)));
        return {...s, prob:+(p.toFixed(2)), risk:+(p.toFixed(2))};
      });
      renderScores();
      drawChart();
      hilLog('System','iteration','k='+state.iteration);
      // TODO [Kibret]: replace with real LR outputs & metrics (accuracy, FPR, runtime).
    }

    // Simple canvas chart (no external libs)
    function drawChart(){
      const c=document.getElementById('chart'); const x=c.getContext('2d');
      x.clearRect(0,0,c.width,c.height);
      const w=c.width, h=c.height, pad=30;
      // Axes
      x.strokeStyle='#314163'; x.beginPath(); x.moveTo(pad, h-pad); x.lineTo(w-pad, h-pad); x.moveTo(pad,pad); x.lineTo(pad,h-pad); x.stroke();
      // Mock accuracy curve from iteration
      const it=state.iteration;
      const points=[0, 0.62, 0.68, 0.73, 0.78, 0.80, 0.82];
      const acc = points[Math.min(points.length-1,it)];
      const series=[0.62, Math.max(0.62, acc)];
      // plot
      x.strokeStyle='#67b0ff'; x.beginPath();
      const yy = v => (h-pad) - v*(h-2*pad);
      series.forEach((v,i)=>{ const px = pad + i*( (w-2*pad)/(series.length-1) ); const py = yy(v); i?x.lineTo(px,py):x.moveTo(px,py); });
      x.stroke();
      // labels
      x.fillStyle='#aab1c2'; x.fillText('accuracy', w-90, pad+10);
      x.fillText('iter='+it, w-80, pad+26);
    }

    // -------------------------
    // HIL CONTROL
    // -------------------------
    function approveSelected(){
      updateHilSelection('approved');
    }
    function rejectSelected(){
      updateHilSelection('rejected');
    }
    function updateHilSelection(newStatus){
      const rows=[...document.querySelectorAll('#hilQueueTable tr.selected')];
      rows.forEach(r=>{
        const idx=+r.dataset.idx;
        state.hilQueue[idx].status=newStatus;
        hilLog(state.auth.role||'Supervisor',newStatus, state.hilQueue[idx].target);
      });
      renderHilQueue();
    }
    function killSwitch(){
      hilLog('Supervisor','kill-switch','all pending tasks');
      alert('Emergency stop engaged (simulated).');
      // TODO [Frecesca]: wire to disable sends / clear timers if any.
    }
    function hilLog(actor,action,obj){
      const tb=document.getElementById('hilLog');
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${new Date().toLocaleTimeString()}</td><td>${actor}</td><td>${action}</td><td>${obj}</td>`;
      tb.prepend(tr);
    }

    // -------------------------
    // INIT
    // -------------------------
    function init(){
      setStatus('warn');
      mockDiscover();
      seedScores();
    }
    init();
  </script>
</body>
</html>
